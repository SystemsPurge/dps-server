# DPS-SERVER
### HTTP api for dpsim basic usage and pandapower optimal powerflow

# ENV

- `DPS_ROOT` : directory of files database
- `DPS_MODE` : work with a local file database, or query a remote dps-server
- `DPS_LOG_LEVEL` : all the log levels supported by the python logging module
- `DPS_DEFAULTS` : path to default simulation parameters when using cli

defaults file must be a json file with all the default simulation parameter values,<br>
that would not be explicitely passed to a cli command. Passed arguments will overwrite<br>
defaults.<br>
# Usage
## Docker
Run docker image `registry.git.rwth-aachen.de/acs/public/dpsv:alpha0.1.0`:<br>
`docker run -p 5000:5000 registry.git.rwth-aachen.de/acs/public/dpsv:alpha0.1.0`<br>
Then send your requests to localhost:5000.<br>
Optionally mount a db folder instead of using http, then use the container cli,
container mount path has to correspond to the DPS_ROOT variable.<br>
`docker run --name dpsv -v $(pwd)/db:/dpsroot registry.git.rwth-aachen.de/acs/public/dpsv:alpha0.1.0`.<br>
You can then put your needed files (xml,profiles) directly in the corresponding db subfolder,and use the cli:<br>
`docker exec dpsv sh -c 'dps run -ux <xml> -up <profile>...etc'`<br>
In this manner, results are retrieved from `<db folder>/result/<sim name>`.<br>

## Helm
To install chart locally on a kubernetes cluster, run <br>
`helm install dpsv ./helm-dpsv --namespace dpsv --create-namespace`<br>
From the root folder. Change persist to true in values, to persist the timeseries/results database <br>
Server has no authentication, hiding it behind a proxy+ IDP is a good idea.<br>

## Open API spec
Generated by fastapi at `/docs` endpoint, see [here](https://fastapi.tiangolo.com/#interactive-api-docs) to learn more.<br>

## Core CLI commands

1. `run` : Run a simulation
    #### Flags:
    - `-n` : Simulation (& result) name
    - `-f` : System Frequency
    - `-d` : Duration
    - `-t` : Timestep
    - `-opf` : Perform a pandapower optimal powerflow
    - `-up` : Use Profile data
    - `-ux` : Use XML files for system
    - `-dom` : Domain
    - `-s` : Solver
1. `tslist <tstype>` : list timeseries of a certain category
    #### Args:
    - `<tstype>` : timeseries type
3. `tsadd <tstype> <tspath>` : add a timeseries
    #### Args:
    - `<tstype>` : timeseries type
    - tspath: path to file
4. `tsdelete <tstype> <tsname>` : delete a timeseries
    #### Args:
    - `<tstype>` : timeseries type
    - `<tsname>`: keywords in file name
5. `xlist` : list xml
6. `xadd <xmlpath>` : add xml (based on the name of the folder/archive they were provided in)
    #### Args:
    - `<xmlpath>` : Path to xml (folder if local mode, otherwise an archive)
7. `xdelete <xmlname>` : delete xml
    #### Args:
    - `<xmlname>` : keywords in file name
8. `jtsget <tstype> <tsname>` : get a timeseries in json
    #### Args:
    - `<tstype>` : timeseries type
    - `<tsname>` : keywords in file name
    #### Flags:
    - -o: Optional output file, otherwise prints to stdout
