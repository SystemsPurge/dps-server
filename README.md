# DPS-SERVER
### HTTP api for dpsim basic usage and pandapower optimal powerflow

# ENV
- `DPS_LOG_LEVEL` : all the log levels supported by the python logging module
# Usage
## Docker
Run docker image `registry.git.rwth-aachen.de/acs/public/dpsv:latest`:
`docker run -p 5000:5000 registry.git.rwth-aachen.de/acs/public/dpsv:latest`
Then send your requests to localhost:5000.<br>
Optionally mount a db folder instead of using http, then use the container cli,
container mount path has to correspond to the DPS_ROOT variable.<br>
`docker run --name dpsv -v $(pwd)/db:/dpsroot registry.git.rwth-aachen.de/acs/public/dpsv:latest`.<br>
You can then put your needed files (xml,profiles) directly in the corresponding db subfolder,and use the cli:
`docker exec dpsv sh -c 'dps run -ux <xml> -up <profile>...etc'`
In this manner, results are retrieved from `<db folder>/result/<sim name>`.<br>

## Helm
To install chart locally on a kubernetes cluster, run 
`helm install dpsv ./helm-dpsv --namespace dpsv --create-namespace`
From the root folder. Change persist to true in values, to persist the timeseries/results database 
Server has no authentication, hiding it behind a proxy+ IDP is a good idea.<br>

## Open API spec
Generated by fastapi at `/docs` endpoint, see [here](https://fastapi.tiangolo.com/#interactive-api-docs) to learn more.<br>

## DPSIM Usage
DPSIM repo is found [here](https://github.com/sogno-platform/dpsim).
This server mirrors some functionality of dpsim, more can be found in the [docs](https://dpsim.fein-aachen.org/docs/).<br>

## Pandapower Usage
This server provides [the optimal powerflow implemented by pandapower](https://github.com/e2nIEE/pandapower/blob/develop/tutorials/pandamodels_opf.ipynb).<br>

This functionality is "TODO" and not fully implemented yet.<br>
## Core CLI commands

1. `run` : Run a simulation
    #### Flags:
    - `-n` : Simulation (& result) name
    - `-f` : System Frequency
    - `-d` : Duration
    - `-t` : Timestep
    - `-opf` : Perform a pandapower optimal powerflow
    - `-up` : Use Profile data
    - `-ux` : Use XML files for system
    - `-dom` : Domain
    - `-s` : Solver
1. `tslist <tstype>` : list timeseries of a certain category
    #### Args:
    - `<tstype>` : timeseries type
3. `tsadd <tstype> <tspath>` : add a timeseries
    #### Args:
    - `<tstype>` : timeseries type
    - tspath: path to file
4. `tsdelete <tstype> <tsname>` : delete a timeseries
    #### Args:
    - `<tstype>` : timeseries type
    - `<tsname>`: keywords in file name
5. `xlist` : list xml
6. `xadd <xmlpath>` : add xml (based on the name of the folder/archive they were provided in)
    #### Args:
    - `<xmlpath>` : Path to xml (folder if local mode, otherwise an archive)
7. `xdelete <xmlname>` : delete xml
    #### Args:
    - `<xmlname>` : keywords in file name
8. `jtsget <tstype> <tsname>` : get a timeseries in json
    #### Args:
    - `<tstype>` : timeseries type
    - `<tsname>` : keywords in file name
    #### Flags:
    - -o: Optional output file, otherwise prints to stdout
